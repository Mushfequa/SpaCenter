/*
	Note: this is a singleton to load all services on startup
	TODO: Move out to config file.
*/
var fs			= require('fs'),
	path		= require('path'),
	_			= require('lodash'),
	sObj		= {},
	services	= {},
	getExtension = function(filename) {
		var ext = path.extname(filename||'').split('.');
		return ext[ext.length - 1];
	};


//	Import all services
fs.readdirSync(__dirname)
	.filter(function(file) {
		return (file.indexOf('.') !== 0) && 
			(file.indexOf('.service.js') !== -1) &&
			(file !== 'index.js') && 
			getExtension(file) == "js";
	})
	.forEach(function(file) {
		var theService = require(path.join(__dirname, file)),
			serviceName = file.split('.service.js').join("");
		sObj[serviceName] = theService;
	});


//	Return the services object
module.exports = function(db) {
	_.forOwn(sObj, function(value, key){
		services[key] = value(db);
	});

	return services;
};